/**
 * libserial
 * Módulo libserial: Manejo de comunicaciones por puerto serie
 *
 * @file      libserial.txt
 * @brief     Documentación de la librería
 * @author    José Luis Sánchez Arroyo
 * @date      2016.04.27
 * @version   1.2.3
 *
 * Copyright (c) 2005-2016 José Luis Sánchez Arroyo
 * This software is distributed under the terms of the LGPL version 2 and comes WITHOUT ANY WARRANTY.
 * Please read the file COPYING.LIB for further details.
 */

====================================================================================================

0. Indice
---------

1. Introducción 

2. Utilización

3. Descripción de funciones

4. Errores conocidos

====================================================================================================

1. Introducción
---------------

Esta librería encapsula el manejo de puertos serie en una sola clase, incluyendo las funciones de
configuración, lectura y escritura.

Cada instancia de la clase representa un puerto serie.


====================================================================================================

2. Utilización
--------------



====================================================================================================

3. Descripción de funciones
---------------------------

Toda la funcionalidad está encapsulada en una sola clase, Serial.

 Constructor
 -----------
  Función: Inicialización de variables y apertura del dispositivo
  Entrada: devname      Path al dispositivo serie
  Salida : -

 Destructor
 ----------
  Función: Devuelve el puerto serie a su configuración anterior
  Entrada: -
  Salida : -

 Init
 ----
  Función: Inicialización del puerto serie
  Entrada: baudrate     Velocidad (bits por segundo) a establecer (B50 ... B4000000)
  Entrada: flowcontrol  Tipo de control de flujo [ = 0 ]
                                0       : Sin control de flujo
                                CRTSCTS : Control de flujo hardware
                                IXON    : Control de flujo XON/XOFF (output)
                                IXOFF   : Control de flujo XON/XOFF (input)
  Entrada: charlen      Tamaño del carácter [ = CS8 ]
                                CS5     : 5 bits
                                CS6     : 6 bits
                                CS7     : 7 bits
                                CS8     : 8 bits
  Entrada: parity       Tipo de paridad [ = 0 ]
                                0       : Sin paridad
                                PARODD  : Paridad impar
                                PARENB  : Paridad par
  Entrada: stopbits     Bits de stop [ = 0 ]
                                0       : 1 bit de stop bit
                                CSTOP   : 2 bits de stop

  Inicializa el puerto serie con los parámetros indicados, guardando los que tenía anteriormente
  para su recuperación en el destructor de la clase.
  Si canonical es false, se desactivan el timeout y la lectura bloqueante.
  Véase: man tcsetattr

 Read
 ----
  Función: Lectura del puerto serie
  Entrada: buf          Buffer en el que escribir lo leido
  Entrada: size         Bytes a leer
  Entrada: t_out        Timeout en ms
  Salida : Bytes leidos, -1 si error

  El modo de lectura (canónica, etc) depende de los parámetros de configuración pasados a Init.
  Ver http://tldp.org/HOWTO/Serial-Programming-HOWTO/x115.html para más información.

 Write
 -----
  Función: Escritura al puerto serie
  Entrada: buf          Buffer con los datos a escribir
  Entrada: size         Bytes a escribir
  Salida : Bytes escritos, -1 si error


 WriteByte
 ---------
  Función: Escritura al puerto serie de un sólo byte
  Entrada: byte         Byte a escribir
  Salida : true si fue bien, false si error

 IsTxFIFOEmpty 
 -------------
  Función: Comprueba si se transmitieron todos los datos por la UART serie
  Entrada: -
  Salida : true si se tansmitieron datos, false en caso contrario

 ClearBuffer
 -----------
  Función: Vaciar buffer de salida
  Entrada: operation    Tipo de operación a realizar
                                CLEAR_BUF_IN    : Borra el buffer de entrada
                                CLEAR_BUF_OUT   : Borra el buffer de salida
                                FLUSH_BUF_OUT   : Vacía el buffer de salida esperando que se acaben de enviar los datos
  Salida : -

 SetLine
 -------
  Función: Establecer el estado de las líneas del puerto serie
  Entrada: line         Línea a controlar
  Entrada: mode         Valor a establecer (on/off)
  Salida : false si error

  Los posibles valores para el parámetro line son los siguientes:
    LINE_LE    
    LINE_DTR   DTR (Data Terminal Ready)
    LINE_RTS   RTS (Ready To Send)
    LINE_ST    ST (Serial Transmit)
    LINE_SR    SR (Serial Receive)
    LINE_CTS   CTS (Clear To Send)
    LINE_CAR   
    LINE_RNG   RNG (Ring)
    LINE_DSR   DSR (Data Send Ready)
  
 GetLine
 -------
  Función: Recuperar el estado de las líneas del puerto serie
  Entrada: line          Línea a controlar
  Salida : 1 si la línea está activa, 0 si está inactiva, -1 si error

  Los valores del parámetro line son los mismos que los de la función SetLine.

 GetBaudCode
 -----------
  Función: Conversión del parámetro de velocidad del puerto de entero a constante válida para Init.
  Entrada: baudrate     Valor de velocidad requerido
           strict       ¿Requerida estrictamente la velocidad del parámetro? [ = false ]
  Salida : Constante correspondiente o la inmediata superior; 0 si no es válida y se pidió estricta

  La función devuelve el código de velocidad más aproximado a la velocidad requerida.
  Si se solicita el código estricto, la función devuelve un error en caso de que el valor no coincida
  con ningún valor de velocidad válido.

====================================================================================================

4. Errores conocidos
--------------------

* Un puerto serie no se puede abrir más de una vez, pero no se toma ninguna medida para impedirlo
  (el sistema dará un error cuando se intente).
